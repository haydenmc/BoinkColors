var EventHandler=function(){function EventHandler(){this.callbacks=new Array}return EventHandler.prototype.subscribe=function(callback){this.callbacks.push(callback)},EventHandler.prototype.unSubscribe=function(callback){var index=this.callbacks.indexOf(callback);this.callbacks=this.callbacks.splice(index,1)},EventHandler.prototype.fire=function(arg){for(var i=0;i<this.callbacks.length;i++)this.callbacks[i](arg)},EventHandler}(),Observable=function(){function Observable(defaultValue){this._onValueChanged=new EventHandler,this._value=defaultValue}return Object.defineProperty(Observable.prototype,"value",{get:function(){return this._value},set:function(newVal){if(this._value!==newVal){var oldVal=this._value;this._value=newVal,this._onValueChanged.fire({oldValue:oldVal,newValue:newVal})}},enumerable:!0,configurable:!0}),Object.defineProperty(Observable.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Observable}(),DataBinder=function(){function DataBinder(dataContext){this._dataContext=dataContext,this.nodeDataBindings=new Array}return Object.defineProperty(DataBinder.prototype,"dataContext",{get:function(){return this._dataContext},set:function(newContext){this._dataContext=newContext,this.resolveAllBindings()},enumerable:!0,configurable:!0}),DataBinder.prototype.processBindings=function(node,dataContext){var _this=this,addedBindings=new Array;if(("undefined"==typeof dataContext||null==dataContext)&&(dataContext=this.dataContext),node instanceof Component)return addedBindings;if(1===node.nodeType||11===node.nodeType)for(var i=0;i<node.childNodes.length;i++)for(var recursiveResult=this.processBindings(node.childNodes[i],dataContext),j=0;j<recursiveResult.length;j++)addedBindings.push(recursiveResult[j]);else if(3===node.nodeType){var bindingMatches=node.nodeValue.match(DataBinder.bindingRegex);if(null!=bindingMatches&&bindingMatches.length>0)for(var i=0;i<bindingMatches.length;i++){for(var absolutePath=bindingMatches[i].substr(2,bindingMatches[i].length-4),path=absolutePath,bindingContext=dataContext;path.indexOf(".")>=0;){var subPath=path.substr(0,path.indexOf("."));if(path=path.substr(path.indexOf(".")+1),null==bindingContext.value){bindingContext=null;break}bindingContext=bindingContext.value[subPath]}if(null==dataContext||null==bindingContext)throw new Error("Node data-binding failed on non- existing property '"+absolutePath+"'.");var bindingInfo={dataContext:dataContext,node:node,bindingPath:absolutePath,originalText:node.nodeValue,updateCallback:null};bindingInfo.updateCallback=function(args){_this.resolveBinding(bindingInfo)},bindingContext.value[path].onValueChanged.subscribe(bindingInfo.updateCallback),this.nodeDataBindings.push(bindingInfo),addedBindings.push(bindingInfo)}}return addedBindings},DataBinder.prototype.resolveBinding=function(bindingInfo){for(var text=bindingInfo.originalText,matches=text.match(DataBinder.bindingRegex),i=0;i<matches.length;i++){var path=matches[i].substr(2,matches[i].length-4),bindingValue="";null!=bindingInfo.dataContext&&null!=bindingInfo.dataContext.value&&null!=bindingInfo.dataContext.value[path]&&null!=bindingInfo.dataContext.value[path].value&&(bindingValue=bindingInfo.dataContext.value[path].value),text=text.replace(matches[i],bindingValue)}bindingInfo.node.nodeValue=text},DataBinder.prototype.resolveBindings=function(bindingInfo){for(var i=0;i<bindingInfo.length;i++)this.resolveBinding(bindingInfo[i])},DataBinder.prototype.resolveAllBindings=function(){for(var i=0;i<this.nodeDataBindings.length;i++)this.resolveBinding(this.nodeDataBindings[i])},DataBinder.prototype.releaseBinding=function(bindingInfo){var observableProperty=bindingInfo.dataContext.value[bindingInfo.bindingPath];observableProperty.onValueChanged.unSubscribe(bindingInfo.updateCallback);for(var i=this.nodeDataBindings.length-1;i--;)this.nodeDataBindings[i]===bindingInfo&&this.nodeDataBindings.splice(i,1)},DataBinder.prototype.releaseBindings=function(bindingInfo){for(var i=0;i<bindingInfo.length;i++)this.releaseBinding(bindingInfo[i])},DataBinder.bindingRegex=/{{[a-zA-Z._0-9]+}}/g,DataBinder}(),NodeDataBindingInformation=function(){function NodeDataBindingInformation(){}return NodeDataBindingInformation}(),__extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Component=function(_super){function Component(){_super.call(this),this.createdCallback()}return __extends(Component,_super),Object.defineProperty(Component.prototype,"dataContext",{get:function(){return this._dataContext},set:function(newContext){this._dataContext=newContext,this.dataBinder.dataContext=newContext},enumerable:!0,configurable:!0}),Component.register=function(elementName,theClass){document.registerElement(elementName,{prototype:theClass.prototype})},Component.prototype.createdCallback=function(){console.log("Component created: "+this.tagName),this._dataContext=new Observable,this.dataBinder=new DataBinder(this.dataContext)},Component.prototype.attachedCallback=function(){if(console.log("Component attached."),null==this.dataContext.value){for(var parentElement=this;"undefined"==typeof parentElement.dataContext||null==parentElement.dataContext.value;)if(parentElement=parentElement.parentElement,null==parentElement)throw new Error("No data context could be found in parents for element '"+this.tagName+"'");this.dataContext=parentElement.dataContext}this.processDataContextAttributeBinding(),this.applyShadowTemplate()},Component.prototype.processDataContextAttributeBinding=function(){var dataContextAttr=this.attributes.getNamedItem("data-context");if(null!=dataContextAttr&&""!==dataContextAttr.value){var dataContextAttrBindingMatches=dataContextAttr.value.match(DataBinder.bindingRegex);if(!(null!=dataContextAttrBindingMatches&&dataContextAttrBindingMatches.length>0))throw new Error("Couldn't parse data context binding expression '"+dataContextAttr.value+"' of "+this.tagName+". Bindings should be of format {{bindingPropertyName}}.");for(var dataContextAttrBindingName=dataContextAttrBindingMatches[0].substr(2,dataContextAttrBindingMatches[0].length-4),bindingContext=this.dataContext;dataContextAttrBindingName.indexOf(".")>=0;){var pathSection=dataContextAttrBindingName.substr(0,dataContextAttrBindingName.indexOf("."));if(dataContextAttrBindingName=dataContextAttrBindingName.substr(dataContextAttrBindingName.indexOf(".")+1),"undefined"==typeof bindingContext.value[pathSection])throw new Error("Couldn't bind data context to non-existing property '"+pathSection+"' in "+this.tagName+".");bindingContext=bindingContext.value[pathSection]}if("undefined"==typeof bindingContext.value[dataContextAttrBindingName])throw new Error("Couldn't bind data context to non-existing property '"+dataContextAttrBindingName+"' in "+this.tagName+".");this.dataContext=bindingContext.value[dataContextAttrBindingName]}},Component.prototype.applyShadowTemplate=function(){var template=document.querySelector("template#"+this.tagName.toLowerCase());if("undefined"!=typeof template&&null!=template){var clone=document.importNode(template.content,!0);this.shadowRoot=this.createShadowRoot();for(var i=0;i<clone.childNodes.length;i++)this.applyMyDataContext(clone.childNodes[i]);if(this.shadowRoot.appendChild(clone),window.ShadowDOMPolyfill){var style=this.shadowRoot.querySelector("style");style&&(style.innerHTML=window.WebComponents.ShadowCSS.shimStyle(style,this.tagName.toLowerCase()))}this.dataBinder.processBindings(this.shadowRoot),this.dataBinder.resolveAllBindings(),this.processEventBindings(this.shadowRoot)}},Component.prototype.processEventBindings=function(node){var _this=this;if(1===node.nodeType)for(var i=0;i<node.attributes.length;i++){var attrName=node.attributes[i].name.toLowerCase(),attrValue=node.attributes[i].value;if("data-event-"===attrName.substr(0,11)){var eventName=attrName.substr(11,attrName.length-11);"undefined"!=typeof this[attrValue]&&node.addEventListener(eventName,function(arg){return _this[attrValue](arg)})}}for(var i=0;i<node.childNodes.length;i++)this.processEventBindings(node.childNodes[i])},Component.prototype.applyMyDataContext=function(node,dataContext){if(("undefined"==typeof dataContext||null==dataContext)&&(dataContext=this.dataContext),node instanceof Component)node._dataContext.value=dataContext.value;else for(var i=0;i<node.childNodes.length;i++)this.applyMyDataContext(node.childNodes[i],dataContext)},Component.prototype.detachedCallback=function(){console.log("Component detached.")},Component.prototype.attributeChangedCallback=function(attrName,oldVal,newVal){console.log("Attribute '"+attrName+"' changed."),"undefined"!=typeof this[attrName]&&(this[attrName]instanceof Observable?this[attrName].value=newVal:this[attrName]=newVal)},Component}(HTMLElement),Application=function(_super){function Application(){_super.apply(this,arguments)}return __extends(Application,_super),Application.prototype.createdCallback=function(){_super.prototype.createdCallback.call(this),Application.instance=this},Application}(Component);Component.register("ui-application",Application);var Page=function(_super){function Page(){_super.apply(this,arguments)}return __extends(Page,_super),Page.prototype.createdCallback=function(){_super.prototype.createdCallback.call(this),this.contentNodes=new Array},Page.prototype.attachedCallback=function(){_super.prototype.attachedCallback.call(this);var pageIdAttr=this.attributes.getNamedItem("data-page-id"),pageId="";pageIdAttr&&(pageId=pageIdAttr.value);var frame=this.parentElement;frame instanceof Frame&&frame.notifyPageLoaded(pageId)},Page.prototype.show=function(){var template=(this.parentNode,this.querySelector("template"));if(template){for(var clone=document.importNode(template.content,!0),i=0;i<clone.childNodes.length;i++)this.contentNodes.push(clone.childNodes[i]);this.appendChild(clone);for(var i=0;i<clone.childNodes.length;i++)this.dataBinder.processBindings(clone.childNodes[i])}else console.error("Page defined without template.")},Page.prototype.hide=function(){},Page}(Component);Component.register("ui-page",Page);var Frame=function(_super){function Frame(){_super.apply(this,arguments)}return __extends(Frame,_super),Frame.prototype.createdCallback=function(){_super.prototype.createdCallback.call(this)},Frame.prototype.attachedCallback=function(){_super.prototype.attachedCallback.call(this)},Frame.prototype.navigateTo=function(page){this.currentPage!==page&&(this.currentPage&&this.currentPage.hide(),this.currentPage=page,page.show())},Frame.prototype.navigateToId=function(pageId){for(var page,i=0;i<this.children.length;i++)this.children[i]instanceof Page&&this.children[i].attributes.getNamedItem("data-page-id")&&this.children[i].attributes.getNamedItem("data-page-id").value===pageId&&(page=this.children[i]);page?this.navigateTo(page):console.error("Attempted to navigate to non-existent page ID '"+pageId+"'.")},Frame.prototype.notifyPageLoaded=function(pageId){if(!this.currentPage){var defaultPageAttr=this.attributes.getNamedItem("data-default-page");defaultPageAttr?pageId===defaultPageAttr.value&&this.navigateToId(pageId):this.navigateToId(pageId)}},Frame}(Component);Component.register("ui-frame",Frame);var ObservableArray=function(){function ObservableArray(){this.itemStore=new Array,this.itemAdded=new EventHandler,this.itemRemoved=new EventHandler}return Object.defineProperty(ObservableArray.prototype,"size",{get:function(){return this.itemStore.length},enumerable:!0,configurable:!0}),ObservableArray.prototype.push=function(item){this.itemStore.push(item),this.itemAdded.fire({item:item,position:this.itemStore.length-1})},ObservableArray.prototype.insert=function(item,index){this.itemStore.splice(index,0,item),this.itemAdded.fire({item:item,position:index})},ObservableArray.prototype.get=function(index){return this.itemStore[index]},ObservableArray.prototype.remove=function(item){var index=this.itemStore.indexOf(item);if(0>index)throw"Item not found in array";this.itemStore.splice(index,1),this.itemRemoved.fire({item:item,position:index})},ObservableArray.prototype.removeAt=function(index){if(index>this.size-1)throw"Index outside of array bounds.";var item=this.itemStore[index];this.itemStore.splice(index,1),this.itemRemoved.fire({item:item,position:index})},ObservableArray.prototype.indexOf=function(item){return this.itemStore.indexOf(item)},ObservableArray}(),Repeater=function(_super){function Repeater(){_super.apply(this,arguments)}return __extends(Repeater,_super),Repeater.prototype.createdCallback=function(){_super.prototype.createdCallback.call(this),this.itemNodes=new Array,this.itemNodeBindings=new Array},Repeater.prototype.dataContextUpdated=function(){for(var _this=this,i=0;i<this.itemNodes.length;i++)for(var j=0;j<this.itemNodes[i].length;j++)this.itemNodes[i][j].parentNode.removeChild(this.itemNodes[i][j]);this.itemNodes.splice(0,this.itemNodes.length),this.itemNodeBindings.splice(0,this.itemNodeBindings.length),this.populateAllItems(),this.dataContext.value.itemAdded.subscribe(function(arg){return _this.itemAdded(arg)}),this.dataContext.value.itemRemoved.subscribe(function(arg){return _this.itemRemoved(arg)})},Repeater.prototype.itemAdded=function(arg){for(var itemDataContext=new Observable(arg.item),clone=document.importNode(this.template.content,!0),cloneNodes=new Array,j=0;j<clone.childNodes.length;j++)cloneNodes.push(clone.childNodes[j]),this.applyMyDataContext(clone.childNodes[j],itemDataContext);var refNode=null;arg.position<this.itemNodes.length&&(refNode=this.itemNodes[arg.position][0]),this.itemNodes.splice(arg.position,0,cloneNodes),arg.position===this.dataContext.value.size-1?this.appendChild(clone):this.insertBefore(clone,refNode);for(var itemBindings=new Array,j=0;j<cloneNodes.length;j++)for(var nodeBindings=this.dataBinder.processBindings(cloneNodes[j],itemDataContext),k=0;k<nodeBindings.length;k++)itemBindings.push(nodeBindings[k]);this.itemNodeBindings.splice(arg.position,0,itemBindings),this.dataBinder.resolveBindings(itemBindings)},Repeater.prototype.itemRemoved=function(arg){var itemBindings=this.itemNodeBindings[arg.position];this.dataBinder.releaseBindings(itemBindings),this.itemNodeBindings.splice(arg.position,1);for(var nodesToBeRemoved=this.itemNodes[arg.position],i=0;i<nodesToBeRemoved.length;i++)nodesToBeRemoved[i].parentNode.removeChild(nodesToBeRemoved[i]);this.itemNodes.splice(arg.position,1)},Repeater.prototype.attachedCallback=function(){var _this=this;if(_super.prototype.attachedCallback.call(this),this.template=this.querySelector("template"),null==this.template)throw new Error("Template undefined for repeater component. A repeater element should always contain a template element.");if(!(this.dataContext.value instanceof ObservableArray))throw new Error("Invalid data context for repeater component. A repeater element should have an observable array set as the data context.");this.dataContext.onValueChanged.subscribe(function(){_this.dataContextUpdated()}),this.dataContextUpdated()},Repeater.prototype.populateAllItems=function(){for(var array=this.dataContext.value,i=0;i<array.size;i++){for(var itemDataContext=new Observable(array.get(i)),clone=document.importNode(this.template.content,!0),cloneNodes=new Array,j=0;j<clone.childNodes.length;j++)cloneNodes.push(clone.childNodes[j]),this.applyMyDataContext(clone.childNodes[j],itemDataContext);this.itemNodes.push(cloneNodes),this.appendChild(clone);for(var itemBindings=new Array,j=0;j<cloneNodes.length;j++)for(var nodeBindings=this.dataBinder.processBindings(cloneNodes[j],itemDataContext),k=0;k<nodeBindings.length;k++)itemBindings.push(nodeBindings[k]);this.itemNodeBindings.push(itemBindings)}this.dataBinder.resolveAllBindings()},Repeater}(Component);Component.register("ui-repeater",Repeater);