var EventHandler=function(){function EventHandler(){this.callbacks=new Array}return EventHandler.prototype.subscribe=function(callback){this.callbacks.push(callback)},EventHandler.prototype.unSubscribe=function(callback){var index=this.callbacks.indexOf(callback);index>=0&&(this.callbacks=this.callbacks.splice(index,1))},EventHandler.prototype.unSubscribeAll=function(){this.callbacks=new Array},EventHandler.prototype.fire=function(arg){for(var i=0;i<this.callbacks.length;i++)this.callbacks[i](arg)},EventHandler}(),Observable=function(){function Observable(defaultValue){this._onValueChanged=new EventHandler,this._value=defaultValue}return Object.defineProperty(Observable.prototype,"value",{get:function(){return this._value},set:function(newVal){if(this._value!==newVal){var oldVal=this._value;this._value=newVal,this._onValueChanged.fire({oldValue:oldVal,newValue:newVal})}},enumerable:!0,configurable:!0}),Object.defineProperty(Observable.prototype,"onValueChanged",{get:function(){return this._onValueChanged},enumerable:!0,configurable:!0}),Observable}(),DataBinding=function(){function DataBinding(path,dataBinder){var _this=this;this.dataBinder=dataBinder,this.path=path,this.childBindings={},path.indexOf(".")>=0?this.property=path.substr(path.lastIndexOf(".")+1):this.property=path,this.onValueChanged=new EventHandler,this.updateCallback=function(args){_this.onValueChanged.fire({path:_this.path,valueChangedEvent:args}),_this.reattachChildren()},this.attachBinding()}return Object.defineProperty(DataBinding.prototype,"value",{get:function(){return DataBinder.resolvePropertyPath(this.path,this.dataBinder.dataContext).value},enumerable:!0,configurable:!0}),DataBinding.prototype.reattachChildren=function(binding,detachFrom){binding||(binding=this);for(var c in binding.childBindings)binding.childBindings.hasOwnProperty(c)&&(binding.childBindings[c].reattachBinding(detachFrom),this.reattachChildren(binding.childBindings[c],detachFrom))},DataBinding.prototype.reattachBinding=function(detachFrom){this.detachBinding(detachFrom),this.attachBinding()},DataBinding.prototype.attachBinding=function(){var prop=DataBinder.resolvePropertyPath(this.path,this.dataBinder.dataContext);prop&&(prop.onValueChanged.subscribe(this.updateCallback),this.onValueChanged.fire({path:this.path,valueChangedEvent:{oldValue:null,newValue:prop.value}}))},DataBinding.prototype.detachBinding=function(detachFrom){var prop;prop=detachFrom?DataBinder.resolvePropertyPath(this.path,detachFrom):DataBinder.resolvePropertyPath(this.path,this.dataBinder.dataContext),prop&&prop.onValueChanged.unSubscribe(this.updateCallback)},DataBinding.prototype.releaseListeners=function(){this.onValueChanged.unSubscribeAll()},DataBinding}(),DataBindingValueChangedEvent=function(){function DataBindingValueChangedEvent(){}return DataBindingValueChangedEvent}(),NodeBinding=function(){function NodeBinding(node,bindings){var _this=this;this.node=node,this.originalValue=this.node.nodeValue,this.bindings=bindings,this.updateCallback=function(args){_this.updateNode()};for(var i=0;i<this.bindings.length;i++)this.bindings[i].onValueChanged.subscribe(this.updateCallback);this.updateNode()}return NodeBinding.prototype.updateNode=function(){for(var newValue=this.originalValue,i=0;i<this.bindings.length;i++)newValue=newValue.replace("{{"+this.bindings[i].path+"}}",this.bindings[i].value);this.node.nodeValue=newValue},NodeBinding}(),DataBinder=function(){function DataBinder(dataContext){this._dataContext=dataContext,this.bindingTree=new DataBinding("",this),this.nodeBindings=[]}return Object.defineProperty(DataBinder.prototype,"dataContext",{get:function(){return this._dataContext},set:function(newContext){if(this._dataContext!==newContext){var oldContext=this._dataContext;this._dataContext=newContext,this.bindingTree.reattachChildren(null,oldContext)}},enumerable:!0,configurable:!0}),DataBinder.prototype.parseBindings=function(str){var bindingProperties=[],bindingMatches=str.match(DataBinder.bindingRegex);if(null!=bindingMatches&&bindingMatches.length>0)for(var i=0;i<bindingMatches.length;i++){var path=bindingMatches[i].substr(2,bindingMatches[i].length-4);bindingProperties.push(path)}return bindingProperties},DataBinder.prototype.bindNodes=function(node){if(!(node instanceof Component))if(1===node.nodeType||11===node.nodeType)for(var i=0;i<node.childNodes.length;i++)this.bindNodes(node.childNodes[i]);else if(3===node.nodeType){for(var bindingMatches=this.parseBindings(node.nodeValue),bindings=[],i=0;i<bindingMatches.length;i++)bindings.push(this.registerBinding(bindingMatches[i]));bindings.length>0&&this.nodeBindings.push(new NodeBinding(node,bindings))}},DataBinder.prototype.registerBinding=function(path){for(var properties=path.split("."),parentBinding=this.bindingTree,traversedPath="",i=0;i<properties.length;i++)if(i>0&&(traversedPath+="."),traversedPath+=properties[i],parentBinding.childBindings[properties[i]])parentBinding=parentBinding.childBindings[properties[i]];else{var bindingInfo=new DataBinding(traversedPath,this);parentBinding.childBindings[properties[i]]=bindingInfo,parentBinding=bindingInfo}return parentBinding},DataBinder.prototype.removeAllBindings=function(binding){var currentBinding;currentBinding=binding?binding:this.bindingTree;for(var childBinding in currentBinding.childBindings)currentBinding.childBindings.hasOwnProperty(childBinding)&&(this.removeAllBindings(currentBinding.childBindings[childBinding]),delete currentBinding.childBindings[childBinding]);currentBinding.detachBinding(),currentBinding.releaseListeners()},DataBinder.resolvePropertyPath=function(path,dataContext){var currentDataContext=dataContext;if(""===path)return currentDataContext;for(var properties=path.split("."),i=0;i<properties.length;i++){if(!currentDataContext.value[properties[i]])return console.warn("Attempted to resolve non-existent property path: '"+path+"'."),null;currentDataContext=currentDataContext.value[properties[i]]}return currentDataContext},DataBinder.bindingRegex=/{{[a-zA-Z._0-9]+}}/g,DataBinder}(),__extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},Component=function(_super){function Component(){_super.call(this),this.createdCallback()}return __extends(Component,_super),Object.defineProperty(Component.prototype,"dataContext",{get:function(){return this._dataContext},set:function(newContext){if(newContext!==this._dataContext){var oldContext=this._dataContext;this._dataContext=newContext,"undefined"!=typeof oldContext&&this.dataContextUpdated(oldContext,newContext)}},enumerable:!0,configurable:!0}),Component.register=function(elementName,theClass){document.registerElement(elementName,{prototype:theClass.prototype})},Component.prototype.createdCallback=function(){console.log("Component created: "+this.tagName)},Component.prototype.attachedCallback=function(){if(console.log("Component attached."),"undefined"==typeof this.dataContext){for(var parentElement=this;"undefined"==typeof parentElement.dataContext;)if(parentElement=parentElement.parentElement,null==parentElement)throw new Error("No data context could be found in parents for element '"+this.tagName+"'");this.dataContext=parentElement.dataContext}this.processDataContextAttributeBinding(),this.dataBinder=new DataBinder(this.dataContext),this.applyShadowTemplate()},Component.prototype.dataContextUpdated=function(oldContext,newContext){this.dataBinder&&(this.dataBinder.dataContext=newContext)},Component.prototype.processDataContextAttributeBinding=function(){var dataContextAttr=this.attributes.getNamedItem("data-context");if(null!=dataContextAttr&&""!==dataContextAttr.value){var dataContextAttrBindingMatches=dataContextAttr.value.match(DataBinder.bindingRegex);if(!(null!=dataContextAttrBindingMatches&&dataContextAttrBindingMatches.length>0))throw new Error("Couldn't parse data context binding expression '"+dataContextAttr.value+"' of "+this.tagName+". Bindings should be of format {{bindingPropertyName}}.");for(var dataContextAttrBindingName=dataContextAttrBindingMatches[0].substr(2,dataContextAttrBindingMatches[0].length-4),bindingContext=this.dataContext;dataContextAttrBindingName.indexOf(".")>=0;){var pathSection=dataContextAttrBindingName.substr(0,dataContextAttrBindingName.indexOf("."));if(dataContextAttrBindingName=dataContextAttrBindingName.substr(dataContextAttrBindingName.indexOf(".")+1),"undefined"==typeof bindingContext.value[pathSection])throw new Error("Couldn't bind data context to non-existing property '"+pathSection+"' in "+this.tagName+".");bindingContext=bindingContext.value[pathSection]}if("undefined"==typeof bindingContext.value[dataContextAttrBindingName])throw new Error("Couldn't bind data context to non-existing property '"+dataContextAttrBindingName+"' in "+this.tagName+".");this.dataContext=bindingContext.value[dataContextAttrBindingName]}},Component.prototype.applyShadowTemplate=function(){var template=document.querySelector("template#"+this.tagName.toLowerCase());if("undefined"!=typeof template&&null!=template){var clone=document.importNode(template.content,!0);this.shadowRoot=this.createShadowRoot();for(var i=0;i<clone.childNodes.length;i++)this.applyMyDataContext(clone.childNodes[i]),this.setParentComponent(clone.childNodes[i]);if(this.shadowRoot.appendChild(clone),window.ShadowDOMPolyfill){var style=this.shadowRoot.querySelector("style");style&&(style.innerHTML=window.WebComponents.ShadowCSS.shimStyle(style,this.tagName.toLowerCase()))}this.dataBinder.bindNodes(this.shadowRoot),this.processEventBindings(this.shadowRoot)}},Component.prototype.processEventBindings=function(node){var _this=this;if(1===node.nodeType)for(var i=0;i<node.attributes.length;i++){var attrName=node.attributes[i].name.toLowerCase(),attrValue=node.attributes[i].value;if("data-event-"===attrName.substr(0,11)){var eventName=attrName.substr(11,attrName.length-11);"undefined"!=typeof this[attrValue]&&node.addEventListener(eventName,function(arg){return _this[attrValue](arg)})}}for(var i=0;i<node.childNodes.length;i++)this.processEventBindings(node.childNodes[i])},Component.prototype.applyMyDataContext=function(node,dataContext){if(("undefined"==typeof dataContext||null==dataContext)&&(dataContext=this.dataContext),node instanceof Component)node.dataContext=dataContext;else for(var i=0;i<node.childNodes.length;i++)this.applyMyDataContext(node.childNodes[i],dataContext)},Component.prototype.setParentComponent=function(node,component){var newParent=this;if(component&&(newParent=component),node instanceof Component)node.parentComponent=newParent;else for(var i=0;i<node.childNodes.length;i++)this.setParentComponent(node.childNodes[i],component)},Component.prototype.detachedCallback=function(){console.log("Component detached.")},Component.prototype.attributeChangedCallback=function(attrName,oldVal,newVal){console.log("Attribute '"+attrName+"' changed."),"undefined"!=typeof this[attrName]&&(this[attrName]instanceof Observable?this[attrName].value=newVal:this[attrName]=newVal)},Component}(HTMLElement),Application=function(_super){function Application(){_super.apply(this,arguments)}return __extends(Application,_super),Application.prototype.createdCallback=function(){_super.prototype.createdCallback.call(this),Application.instance=this},Application}(Component);Component.register("ui-application",Application);var Page=function(_super){function Page(){_super.apply(this,arguments)}return __extends(Page,_super),Page.prototype.createdCallback=function(){_super.prototype.createdCallback.call(this),this.contentNodes=new Array},Page.prototype.attachedCallback=function(){_super.prototype.attachedCallback.call(this);var pageIdAttr=this.attributes.getNamedItem("data-page-id"),pageId="";pageIdAttr&&(pageId=pageIdAttr.value);var frame=this.parentElement;frame instanceof Frame&&frame.notifyPageLoaded(pageId)},Page.prototype.show=function(){var template=(this.parentNode,this.querySelector("template"));if(template){for(var clone=document.importNode(template.content,!0),i=0;i<clone.childNodes.length;i++)this.contentNodes.push(clone.childNodes[i]),this.setParentComponent(clone.childNodes[i]);this.appendChild(clone);for(var i=0;i<clone.childNodes.length;i++)this.dataBinder.bindNodes(clone.childNodes[i])}else console.error("Page defined without template.")},Page.prototype.hide=function(){},Page}(Component);Component.register("ui-page",Page);var Frame=function(_super){function Frame(){_super.apply(this,arguments)}return __extends(Frame,_super),Frame.prototype.createdCallback=function(){_super.prototype.createdCallback.call(this)},Frame.prototype.attachedCallback=function(){_super.prototype.attachedCallback.call(this)},Frame.prototype.navigateTo=function(page){this.currentPage!==page&&(this.currentPage&&this.currentPage.hide(),this.currentPage=page,page.show())},Frame.prototype.navigateToId=function(pageId){for(var page,i=0;i<this.children.length;i++)this.children[i]instanceof Page&&this.children[i].attributes.getNamedItem("data-page-id")&&this.children[i].attributes.getNamedItem("data-page-id").value===pageId&&(page=this.children[i]);page?this.navigateTo(page):console.error("Attempted to navigate to non-existent page ID '"+pageId+"'.")},Frame.prototype.notifyPageLoaded=function(pageId){if(!this.currentPage){var defaultPageAttr=this.attributes.getNamedItem("data-default-page");defaultPageAttr?pageId===defaultPageAttr.value&&this.navigateToId(pageId):this.navigateToId(pageId)}},Frame}(Component);Component.register("ui-frame",Frame);var ObservableArray=function(){function ObservableArray(){this.itemStore=new Array,this.itemAdded=new EventHandler,this.itemRemoved=new EventHandler}return Object.defineProperty(ObservableArray.prototype,"size",{get:function(){return this.itemStore.length},enumerable:!0,configurable:!0}),ObservableArray.prototype.push=function(item){this.itemStore.push(item),this.itemAdded.fire({item:item,position:this.itemStore.length-1})},ObservableArray.prototype.insert=function(item,index){this.itemStore.splice(index,0,item),this.itemAdded.fire({item:item,position:index})},ObservableArray.prototype.get=function(index){return this.itemStore[index]},ObservableArray.prototype.remove=function(item){var index=this.itemStore.indexOf(item);if(0>index)throw"Item not found in array";this.itemStore.splice(index,1),this.itemRemoved.fire({item:item,position:index})},ObservableArray.prototype.removeAt=function(index){if(index>this.size-1)throw"Index outside of array bounds.";var item=this.itemStore[index];this.itemStore.splice(index,1),this.itemRemoved.fire({item:item,position:index})},ObservableArray.prototype.indexOf=function(item){return this.itemStore.indexOf(item)},ObservableArray}(),Repeater=function(_super){function Repeater(){_super.apply(this,arguments)}return __extends(Repeater,_super),Repeater.prototype.createdCallback=function(){_super.prototype.createdCallback.call(this),this.repeaterItems=[],this.itemEventCallbacks={}},Repeater.prototype.attachedCallback=function(){if(_super.prototype.attachedCallback.call(this),this.template=this.querySelector("template"),null==this.template)throw new Error("Template undefined for repeater component. A repeater element should always contain a template element.");if(!(this.dataContext.value instanceof ObservableArray))throw new Error("Invalid data context for repeater component. A repeater element should have an observable array set as the data context.");for(var i=0;i<this.attributes.length;i++){var attributeName=this.attributes[i].name,attributeValue=this.attributes[i].value;if(0===attributeName.indexOf("data-event-item-")){var eventName=attributeName.replace("data-event-item-","");this.parentComponent&&this.parentComponent[attributeValue]?this.itemEventCallbacks[eventName]=this.parentComponent[attributeValue]:console.error(this.tagName+" attempted to bind event to unexisting callback '"+attributeValue+"' on "+this.parentComponent.tagName)}}this.dataContext&&this.dataContext.value instanceof ObservableArray?this.populateAllItems():console.warn(this.tagName+" attached without a valid data context, expecting an ObservableArray.")},Repeater.prototype.processEventBindings=function(node){},Repeater.prototype.dataContextUpdated=function(oldContext,newContext){var _this=this;_super.prototype.dataContextUpdated.call(this,oldContext,newContext),this.clearItems(),this.populateAllItems(),this.dataContext.value.itemAdded.subscribe(function(arg){return _this.itemAdded(arg)}),this.dataContext.value.itemRemoved.subscribe(function(arg){return _this.itemRemoved(arg)})},Repeater.prototype.itemAdded=function(arg){var itemDataContext=new Observable(arg.item);this.addItem(itemDataContext,arg.position)},Repeater.prototype.itemRemoved=function(arg){this.removeItem(arg.position)},Repeater.prototype.populateAllItems=function(){for(var array=this.dataContext.value,i=0;i<array.size;i++){var itemDataContext=new Observable(array.get(i));this.addItem(itemDataContext)}},Repeater.prototype.addItem=function(dataContext,position){"undefined"==typeof position&&(position=this.repeaterItems.length);for(var newItem={dataContext:dataContext,dataBinder:new DataBinder(dataContext),nodes:[]},clone=document.importNode(this.template.content,!0),i=0;i<clone.childNodes.length;i++)newItem.nodes.push(clone.childNodes[i]),this.applyMyDataContext(clone.childNodes[i],dataContext),this.setParentComponent(clone.childNodes[i],this.parentComponent),this.applyRepeaterEvents(clone.childNodes[i],dataContext),newItem.dataBinder.bindNodes(clone.childNodes[i]);var refNode=null;if(0===this.repeaterItems.length)refNode=this.nextSibling;else if(position<this.repeaterItems.length)refNode=this.repeaterItems[position].nodes[0];else{var lastItem=this.repeaterItems[this.repeaterItems.length-1];refNode=lastItem.nodes[lastItem.nodes.length-1].nextSibling}this.repeaterItems.splice(position,0,newItem),this.parentNode.insertBefore(clone,refNode)},Repeater.prototype.removeItem=function(position){var item=this.repeaterItems[position];this.repeaterItems.splice(position,1),item.dataBinder.removeAllBindings();for(var nodesToBeRemoved=item.nodes,i=0;i<nodesToBeRemoved.length;i++)nodesToBeRemoved[i].parentNode.removeChild(nodesToBeRemoved[i])},Repeater.prototype.clearItems=function(){for(var i=this.repeaterItems.length-1;i>=0;i--)this.removeItem(i)},Repeater.prototype.applyRepeaterEvents=function(node,dataContext){var _this=this;for(var eventName in this.itemEventCallbacks)this.itemEventCallbacks[eventName]&&node.addEventListener(eventName,function(args){return _this.itemEventCallbacks[eventName](dataContext)})},Repeater}(Component);Component.register("ui-repeater",Repeater);var ObservableProxy=function(){function ObservableProxy(source,outgoing,incoming){var _this=this;this.source=source,this.outgoing=outgoing,this.incoming=incoming,this.onValueChanged=new EventHandler,this.source.onValueChanged.subscribe(function(arg){_this.onValueChanged.fire({oldValue:_this.outgoing(arg.oldValue),newValue:_this.outgoing(arg.newValue)})})}return Object.defineProperty(ObservableProxy.prototype,"value",{get:function(){return this.outgoing(this.source.value)},set:function(val){this.source.value=this.incoming(val,this.source.value)},enumerable:!0,configurable:!0}),ObservableProxy}();